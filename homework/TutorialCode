###JC

data <- readDiscreteCharacterData("data/primates_and_galeopterus_cytb.nex")
data

num_taxa <- data.ntaxa()
num_branches <- 2 * num_taxa - 3

taxa <- data.taxa()

moves    = VectorMoves()
monitors = VectorMonitors()

Q <- fnJC(4)
Q

out_group = clade("Galeopterus_variegatus")
topology ~ dnUniformTopology(taxa, outgroup=out_group)

moves.append( mvNNI(topology, weight=num_taxa) )
moves.append( mvSPR(topology, weight=num_taxa/10.0) )

for (i in 1:num_branches) {
   br_lens[i] ~ dnExponential(10.0)
   moves.append( mvScale(br_lens[i]) )
}

TL := sum(br_lens)

psi := treeAssembly(topology, br_lens)

seq ~ dnPhyloCTMC(tree=psi, Q=Q, type="DNA")
seq.clamp(data)


mymodel = model(Q)
mymodel

monitors.append( mnModel(filename="output/primates_cytb_JC.log", printgen=10) )
monitors.append( mnFile(filename="output/primates_cytb_JC.trees", printgen=10, psi) )
monitors.append( mnScreen(printgen=1000, TL) )

mymcmc = mcmc(mymodel, monitors, moves, nruns=2, combine="mixed")
mymcmc.run(generations=20000,tuningInterval=200)

treetrace = readTreeTrace("output/primates_cytb_JC.trees", treetype="non-clock", outgroup=out_group)
map_tree = mapTree(treetrace,"output/primates_cytb_JC_MAP.tree")

Lemuroidea <- clade("Cheirogaleus_major",
                    "Daubentonia_madagascariensis",
                    "Lemur_catta",
                    "Lepilemur_hubbardorum",
                    "Microcebus_murinus",
                    "Propithecus_coquereli",
                    "Varecia_variegata_variegata")

treetrace.cladeProbability( Lemuroidea )

Lorisidae <- clade("Galago_senegalensis",
                    "Loris_tardigradus",
                    "Nycticebus_coucang",
                    "Otolemur_crassicaudatus",
                    "Perodicticus_potto")

treetrace.cladeProbability( Lorisidae )

Platyrrhini <- clade("Aotus_trivirgatus",
                     "Callicebus_donacophilus",
                     "Cebus_albifrons",
                     "Saimiri_sciureus")

treetrace.cladeProbability( Platyrrhini )

Catarrhini <- clade("Chlorocebus_aethiops",
                    "Colobus_guereza",
                    "Hylobates_lar",
                    "Macaca_mulatta",
                    "Pan_paniscus")

treetrace.cladeProbability( Catarrhini )


##HKY

data <- readDiscreteCharacterData("data/primates_and_galeopterus_cytb.nex")
data

num_taxa <- data.ntaxa()
num_branches <- 2 * num_taxa - 3

taxa <- data.taxa()

moves    = VectorMoves()
monitors = VectorMonitors()

out_group = clade("Galeopterus_variegatus")
topology ~ dnUniformTopology(taxa, outgroup=out_group)

moves.append( mvNNI(topology, weight=num_taxa) )
moves.append( mvSPR(topology, weight=num_taxa/10.0) )

pi_prior <- v(1,1,1,1)
pi ~ dnDirichlet(pi_prior)

moves.append( mvBetaSimplex(pi, weight=2) )
moves.append( mvDirichletSimplex(pi, weight=1) )

kappa ~ dnLognormal(0.0, 1.0)

moves.append( mvScale(kappa) )

Q := fnHKY(kappa,pi)
Q

for (i in 1:num_branches) {
   br_lens[i] ~ dnExponential(10.0)
   moves.append( mvScale(br_lens[i]) )
}

TL := sum(br_lens)

psi := treeAssembly(topology, br_lens)


seq ~ dnPhyloCTMC(tree=psi, Q=Q, type="DNA")
seq.clamp(data)


mymodel = model(Q)
mymodel

monitors.append( mnModel(filename="output/primates_cytb_HKY.log", printgen=10) )
monitors.append( mnFile(filename="output/primates_cytb_HKY.trees", printgen=10, psi) )
monitors.append( mnScreen(printgen=1000, TL) )

mymcmc = mcmc(mymodel, monitors, moves, nruns=2, combine="mixed")
mymcmc.run(generations=20000,tuningInterval=200)

treetrace = readTreeTrace("output/primates_cytb_HKY.trees", treetype="non-clock", outgroup=out_group)
map_tree = mapTree(treetrace,"output/primates_cytb_HKY_MAP.tree")

Lemuroidea <- clade("Cheirogaleus_major",
                    "Daubentonia_madagascariensis",
                    "Lemur_catta",
                    "Lepilemur_hubbardorum",
                    "Microcebus_murinus",
                    "Propithecus_coquereli",
                    "Varecia_variegata_variegata")

treetrace.cladeProbability( Lemuroidea )

Lorisidae <- clade("Galago_senegalensis",
                    "Loris_tardigradus",
                    "Nycticebus_coucang",
                    "Otolemur_crassicaudatus",
                    "Perodicticus_potto")

treetrace.cladeProbability( Lorisidae )

Platyrrhini <- clade("Aotus_trivirgatus",
                     "Callicebus_donacophilus",
                     "Cebus_albifrons",
                     "Saimiri_sciureus")

treetrace.cladeProbability( Platyrrhini )

Catarrhini <- clade("Chlorocebus_aethiops",
                    "Colobus_guereza",
                    "Hylobates_lar",
                    "Macaca_mulatta",
                    "Pan_paniscus")

treetrace.cladeProbability( Catarrhini )

##F81

data <- readDiscreteCharacterData("data/primates_and_galeopterus_cytb.nex")
data

num_taxa <- data.ntaxa()
num_branches <- 2 * num_taxa - 3

taxa <- data.taxa()

moves    = VectorMoves()
monitors = VectorMonitors()

out_group = clade("Galeopterus_variegatus")
topology ~ dnUniformTopology(taxa, outgroup=out_group)

moves.append( mvNNI(topology, weight=num_taxa) )
moves.append( mvSPR(topology, weight=num_taxa/10.0) )

pi_prior <- v(1,1,1,1)
pi ~ dnDirichlet(pi_prior)

moves.append( mvBetaSimplex(pi, weight=2) )
moves.append( mvDirichletSimplex(pi, weight=1) )

Q := fnF81(pi)
Q

for (i in 1:num_branches) {
   br_lens[i] ~ dnExponential(10.0)
   moves.append( mvScale(br_lens[i]) )
}

TL := sum(br_lens)

psi := treeAssembly(topology, br_lens)

seq ~ dnPhyloCTMC(tree=psi, Q=Q, type="DNA")
seq.clamp(data)


mymodel = model(Q)
mymodel

monitors.append( mnModel(filename="output/primates_cytb_F81.log", printgen=10) )
monitors.append( mnFile(filename="output/primates_cytb_F81.trees", printgen=10, psi) )
monitors.append( mnScreen(printgen=1000, TL) )

mymcmc = mcmc(mymodel, monitors, moves, nruns=2, combine="mixed")
mymcmc.run(generations=20000,tuningInterval=200)

treetrace = readTreeTrace("output/primates_cytb_F81.trees", treetype="non-clock", outgroup=out_group)
map_tree = mapTree(treetrace,"output/primates_cytb_F81_MAP.tree")

Lemuroidea <- clade("Cheirogaleus_major",
                    "Daubentonia_madagascariensis",
                    "Lemur_catta",
                    "Lepilemur_hubbardorum",
                    "Microcebus_murinus",
                    "Propithecus_coquereli",
                    "Varecia_variegata_variegata")

treetrace.cladeProbability( Lemuroidea )

Lorisidae <- clade("Galago_senegalensis",
                    "Loris_tardigradus",
                    "Nycticebus_coucang",
                    "Otolemur_crassicaudatus",
                    "Perodicticus_potto")

treetrace.cladeProbability( Lorisidae )

Platyrrhini <- clade("Aotus_trivirgatus",
                     "Callicebus_donacophilus",
                     "Cebus_albifrons",
                     "Saimiri_sciureus")

treetrace.cladeProbability( Platyrrhini )

Catarrhini <- clade("Chlorocebus_aethiops",
                    "Colobus_guereza",
                    "Hylobates_lar",
                    "Macaca_mulatta",
                    "Pan_paniscus")

treetrace.cladeProbability( Catarrhini )


##GTR

data <- readDiscreteCharacterData("data/primates_and_galeopterus_cytb.nex")
data

num_taxa <- data.ntaxa()
num_branches <- 2 * num_taxa - 3

taxa <- data.taxa()

moves    = VectorMoves()
monitors = VectorMonitors()

er_Prior <- v(1,1,1,1,1,1)
pi_Prior <- v(1,1,1,1)
er ~ dnDirichlet ( er_Prior )
pi ~ dnDirichlet( pi_Prior )

moves.append( mvBetaSimplex(er, weight=3) )
moves.append( mvDirichletSimplex(er, weight=1) )

moves.append( mvBetaSimplex(pi, weight=2) )
moves.append( mvDirichletSimplex(pi, weight=1) )

Q <- fnGTR(er, pi)
Q

out_group = clade("Galeopterus_variegatus")
topology ~ dnUniformTopology(taxa, outgroup=out_group)

moves.append( mvNNI(topology, weight=num_taxa) )
moves.append( mvSPR(topology, weight=num_taxa/10.0) )

for (i in 1:num_branches) {
   br_lens[i] ~ dnExponential(10.0)
   moves.append( mvScale(br_lens[i]) )
}

TL := sum(br_lens)

psi := treeAssembly(topology, br_lens)

seq ~ dnPhyloCTMC(tree=psi, Q=Q, type="DNA")
seq.clamp(data)


mymodel = model(Q)
mymodel

monitors.append( mnModel(filename="output/primates_cytb_GTR.log", printgen=10) )
monitors.append( mnFile(filename="output/primates_cytb_GTR.trees", printgen=10, psi) )
monitors.append( mnScreen(printgen=1000, TL) )

mymcmc = mcmc(mymodel, monitors, moves, nruns=2, combine="mixed")
mymcmc.run(generations=20000,tuningInterval=200)

treetrace = readTreeTrace("output/primates_cytb_GTR.trees", treetype="non-clock", outgroup=out_group)
map_tree = mapTree(treetrace,"output/primates_cytb_GTR_MAP.tree")

Lemuroidea <- clade("Cheirogaleus_major",
                    "Daubentonia_madagascariensis",
                    "Lemur_catta",
                    "Lepilemur_hubbardorum",
                    "Microcebus_murinus",
                    "Propithecus_coquereli",
                    "Varecia_variegata_variegata")

treetrace.cladeProbability( Lemuroidea )

Lorisidae <- clade("Galago_senegalensis",
                    "Loris_tardigradus",
                    "Nycticebus_coucang",
                    "Otolemur_crassicaudatus",
                    "Perodicticus_potto")

treetrace.cladeProbability( Lorisidae )

Platyrrhini <- clade("Aotus_trivirgatus",
                     "Callicebus_donacophilus",
                     "Cebus_albifrons",
                     "Saimiri_sciureus")

treetrace.cladeProbability( Platyrrhini )

Catarrhini <- clade("Chlorocebus_aethiops",
                    "Colobus_guereza",
                    "Hylobates_lar",
                    "Macaca_mulatta",
                    "Pan_paniscus")

treetrace.cladeProbability( Catarrhini )
